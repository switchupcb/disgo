# Contributing

## License

You agree to license any contribution to this library under the [Apache License 2.0](#license).

## Pull Requests

Pull requests must follow the [code specification](#code-specification) and work with all [test cases](#test).

## Domain

The domain of Disgo in providing an API for HTTP/WebSocket requests. The program uses provided structures (from the [Discord API](https://discord.com/developers/docs/reference)) to provide simple abstractions for end users _(developers)_.

## Project Structure

The repository consists of a detailed [README](/README.md), [examples](/examples/), and [**API Wrapper**](/disgo/).

### Disgo

The API Wrapper consists of multiple packages. A [bundler](https://pkg.go.dev/golang.org/x/tools/cmd/bundle) is used to package the API into a single-usable package.

| Package   | Description                                   |
| :-------- | :-------------------------------------------- |
| wrapper   | Contains the wrapper bundling functionality.  |
| client    | The Disgo Client Abstraction.                 |
| events    | Discord API Events.                           |
| pkg       | Utility functionality for specific libraries. |
| requests  | Discord API Requests.                         |
| resources | Discord API Resources.                        |
| sessions  | Discord API WebSocket Sessions (Gateways).    |

#### Structs

Structs are sourced from [Discord API Spec](https://github.com/switchupcb/discord-api-spec) and refactored into the correct name scheme for end users. The abstraction _(i.e Resource)_ is pre-pended to the resource name _(i.e User)_ to speed up development. Modern IDE's will show the developer a list of resources when `disgo.R` is typed; rather than a bunch of irrelevant resources, functions, and variables.

```go
disgo.ResourceUser
disgo.RequestGetUser
```

##### Fields

We must maintain correctness with the `omitempty` JSON tag in order to avoid issues with certain requests. An `omitempty` tag should **always** be applied. In contrast, a pointer should only be applied to a field when the _Field's Discord Representation_ can **NOT** be equal to the Go Type's zero-value. For example, [Application Command Types](https://discord.com/developers/docs/interactions/application-commands#application-command-object-application-command-types) are never equal to 0. In contrast, an unsigned integer — which represents the Go `FlagTypeCommandApplication` — has a zero-value equal to 0. This means an uninitialized unsigned integer _(which is equal to 0)_ can be considered as a `nil` value for the `FlagTypeCommandApplication`. As a result, fields that reference `FlagTypeCommandApplication` should **NOT** be a pointer.

```go
type Application struct {
	Flags uint `json:"flags,omitempty"`
}
```

If this is not the case _(i.e [Verification Level](https://discord.com/developers/docs/resources/guild#guild-object-verification-level)),_ fields that reference the type **SHOULD** be a pointer.
 
```go
type Guild struct {
	VerificationLevel *uint `json:"verification_level,omitempty"`
}
```

An empty struct response should **NOT** create a struct with default values. As a result, **structs** with `omitempty` must always be pointers.

```go
type Embed struct {
	Author *EmbedAuthor `json:"author,omitempty"`
}
```

An exception is provided to interfaces, slices, channels, and maps, which should **NEVER** be pointers, but may contain pointers to types.

#### JSON

JSON unmarshal and marshal functions are generated from structs.

```go
// TODO: Example of JSON unmarshal and marshal function (if necessary).
```

#### HTTP

Resource GET, DELETE, POST, PUT, BULK _(GET, ...)_ are autogenerated from JSON Param structs.

```go
// TODO: Example of REST request function.
```

### Code Specification

#### Comments

Comments follow [Effective Go](https://golang.org/doc/effective_go#commentary) and explain why more than what _(unless the "what" isn't intuitive)_.

#### Static Code Analysis

Disgo uses [golangci-lint](https://github.com/golangci/golangci-lint) in order to statically analyze code. You can install golangci-lint with `go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.45.0` and run it using `golangci-lint run`. If you receive a `diff` error, you must add a `diff` tool in your PATH. There is one located in the `Git` bin.

If you receive `File is not ... with -...`, use `golangci-lint run --disable-all --no-config -Egofmt --fix`.

#### Fieldalignment

Disgo uses [fieldalignment]() to save memory. You can install fieldalignment with `go install golang.org/x/tools/go/analysis/passes/fieldalignment/cmd/fieldalignment@latest` and run it using `fieldalignment -fix <package>`.

### Test

#### Unit Tests

Unit tests are used to test logic.

#### Integration Tests

Integration tests are used to ensure functionality between the API and Discord.

# Roadmap

Disgo is currently a PROOF OF CONCEPT. Here are the steps required in order to complete it:

1. Make [decisions](/contribution/libraries/) for libraries.
2. Generate [json](#json) unmarshal and marshal code (if required; likely not).
3. Generate [http](#http) code.
4. Generate any other code.
5. Implement Client once.
6. Implement Sharding once.
7. Implement Cache (which is likely where most effort lies; caching is difficult).
